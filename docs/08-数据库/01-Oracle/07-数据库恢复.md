# 恢复数据库方法

## （一）拷贝数据库备份

### 1.先将所有backup/rman下的所有备份文件拷贝到目标恢复机器

```
[oracle@amcfadb rman]$ pwd
/backup/rman
[oracle@amcfadb rman]$ ls -lrt
total 9268924
-rw-r--r-- 1 oracle oinstall        685 Jul  6  2017 rman_fadb.rcv
-rw-r--r-- 1 oracle oinstall       1322 Jul 11  2017 check_backup.sh
-rw-r--r-- 1 oracle oinstall        397 Jul 18  2017 backup.sh
-rw-r----- 1 oracle oinstall  420632576 Sep  6 22:05 fadb_ARC_lptcf98n_1_1
-rw-r----- 1 oracle oinstall  532548096 Sep  6 22:08 fadb_ARC_lntcf98l_1_1
-rw-r----- 1 oracle oinstall  607187456 Sep  6 22:10 fadb_ARC_lotcf98n_1_1
-rw-r----- 1 oracle oinstall 2185125888 Sep  6 22:34 fadb_full_lqtcf9rf_1_1
-rw-r----- 1 oracle oinstall    1294336 Sep  6 22:34 fadb_full_lttcfb7p_1_1
-rw-r----- 1 oracle oinstall      98304 Sep  6 22:34 fadb_full_lutcfb7t_1_1
-rw-r----- 1 oracle oinstall 2946318336 Sep  6 22:43 fadb_full_lstcf9rg_1_1
-rw-r----- 1 oracle oinstall 2730688512 Sep  6 22:43 fadb_full_lrtcf9rf_1_1
-rw-r----- 1 oracle oinstall   46116864 Sep  6 22:43 fadb_ARC_lvtcfbo0_1_1
-rw-r----- 1 oracle oinstall   21200896 Sep  6 22:43 fadb_control_bak_20180906
-rw-r----- 1 oracle oinstall      98304 Sep  6 22:43 fadb_spfile_bak_20180906
-rw-r--r-- 1 oracle oinstall      16592 Sep  6 22:43 fadb_rman_20180906220002_full.log
-rw-r--r-- 1 oracle oinstall         49 Sep  6 22:43 backup_status.log
```

### 2.到目标机器看rman下是否有文件，如果有而且是以前的数据就删除掉，  

```
[oracle@amcfadb rman]:fadb> ls
backup.sh                  fadb_full_88si8pvp_1_1
backup_status.log          fadb_full_89si8pvp_1_1
check_backup.sh            fadb_full_8asi8pvp_1_1
fadb_ARC_85si8pva_1_1      fadb_full_8bsi8qqh_1_1
fadb_ARC_86si8pva_1_1      fadb_full_8csi8qql_1_1
fadb_ARC_87si8pva_1_1      fadb_rman_20171029220002_full.log
fadb_ARC_8dsi8r2c_1_1      fadb_spfile_bak_20171029
fadb_control_bak_20171029  rman_fadb.rcv
[oracle@amcfadb rman]:fadb> rm -f *
[oracle@amcfadb rman]:fadb> ls -lrt
total 0
```

## （二）开始恢复数据库

### 1.启动到nomount状态

```
startup nomount
```

### 2.恢复控制文件

```
rman target /
restore controlfile from '/backup/fadb/rman/fadb_control_bak_20180906';
```

### 3.挂载数据库

```
alter database mount;
```

### 4.注册备份片

```
catalog start with '/backup/fadb/rman';
```

### 5.恢复数据库（rman里执行）

```
run {
allocate channel c1 type disk;
allocate channel c2 type disk;
allocate channel c3 type disk;
allocate channel c4 type disk;
restore database;
recover database;
release channel c1;
release channel c2;
release channel c3;
release channel c4;
}
```

### 6.打开数据库（sqlplus里执行）

```
recover database until cancel using backup controlfile;       （先AUTO再跑一次选CANCEL）

alter database open resetlogs;
```
